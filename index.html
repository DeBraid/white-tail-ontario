<!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" type="text/css" href="styles.css">
  <script src="https://d3js.org/d3.v5.min.js"></script>
</head>
<body>

  <script>
    // URL of dataset
    var geoJsonPath = "data.geojson";

    // Set width and height of the map
    var width = 800,
      height = 800;

    // Sets the projection and scale of the map
    var projection = d3.geoMercator()
      .scale(1800)
      .translate([width / 4, height / 6])
      .center([-91.5445018, 55.2280993]);

    // Return the projection object
    var path = d3.geoPath()
      .projection(projection);

    // Create the object that will contain the map
    var map = d3.select("body")
      .append("svg")
      .attr("width", width)
      .attr("height", height);

    // Add a text-box for the feature name
    var featureName = map.append('text')
      .classed('big-text', true)
      .attr('x', width/1.75)
      .attr('y', 45);

    // Load the data
    d3.json(geoJsonPath).then((mapData) => {

      // Get features array
      var features = mapData.features;


      // TODO: need to merge harvest values with features


      // Set the color scale
      var minDomain = 0;
      var maxDomain = features.length;
      var color = d3.scaleLinear().domain([minDomain, maxDomain]).range(["#f2ffe6","#59b300"]);

      // Add the polygons
      var polygons = map.selectAll('path')
        .data(features)
        .enter()
        .append('path')
        .attr('d', path)
        .attr("fill", fillFunction)
        .attr("fill-opacity", 0.5)
        .attr("stroke", "#222")
        .on('mouseover', onMouseOver)
        .on('mouseout', onMouseOut);

      // OnMouseOver function
      function onMouseOver(d, i) {
        console.log('onMouseOver properties', d.properties);
        d3.select(this).attr('fill', '#ffcb6b');
        const featureText = d.properties.NAME + ' - ' + Math.round(d.properties.SYS_AREA/1000000) + '   KMÂ²';

        featureName.text(featureText);
      }

      // OnMouseOut function
      function onMouseOut(d, i) {
        d3.select(this).attr('fill', fillFunction(d,i));
        featureName.text('');
      }

      // Fill function
      function fillFunction(d, i) {
        console.log('i', i);
        return color(i);
      }
    });

  </script>
</body>

</html>
